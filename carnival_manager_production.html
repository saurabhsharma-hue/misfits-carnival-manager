<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misfits Carnival Manager - Production</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="description" content="Complete carnival and event management system for Misfits">
    <meta name="keywords" content="carnival, event management, task tracking, club management">
    <meta name="author" content="Misfits Team">

    <!-- Production Optimizations -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .hidden { display: none !important; }
        .view { display: block; }

        /* Production styles for better performance */
        .transition-shadow { transition: box-shadow 0.15s ease; }
        .transition-colors { transition: color 0.15s ease, background-color 0.15s ease; }

        /* Loading state */
        .loading {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Loading indicator -->
    <div id="loading-indicator" class="fixed top-0 left-0 w-full h-1 bg-indigo-600 loading hidden z-50"></div>

    <div id="app" class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <header class="mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-4xl font-extrabold text-indigo-700 tracking-tight">
                        üé™ Misfits Carnival Program Manager
                    </h1>
                    <p class="mt-2 text-lg text-gray-600">
                        Complete Task Management System - Production v1.0
                    </p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-500">Production Environment</div>
                    <div class="text-xs text-gray-400" id="last-updated">Last Updated: Loading...</div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="flex space-x-4 border-b border-gray-200 mb-6" role="tablist">
            <button onclick="showView('dashboard')" id="tab-dashboard" class="py-2 px-4 text-sm font-medium rounded-t-lg transition-colors duration-200 text-indigo-600 border-b-2 border-indigo-600" role="tab" aria-selected="true">
                Dashboard
            </button>
            <button onclick="showView('task-tracker')" id="tab-task-tracker" class="py-2 px-4 text-sm font-medium rounded-t-lg transition-colors duration-200 text-gray-500 hover:text-gray-700" role="tab">
                Task Tracker
            </button>
            <button onclick="showView('timeline')" id="tab-timeline" class="py-2 px-4 text-sm font-medium rounded-t-lg transition-colors duration-200 text-gray-500 hover:text-gray-700" role="tab">
                Timeline
            </button>
            <button onclick="showView('setup')" id="tab-setup" class="py-2 px-4 text-sm font-medium rounded-t-lg transition-colors duration-200 text-gray-500 hover:text-gray-700" role="tab">
                Setup & Template
            </button>
        </nav>

        <!-- Dashboard View -->
        <div id="dashboard-view" class="view" role="tabpanel">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">üìä Dashboard</h2>

            <!-- Filters -->
            <div class="bg-white p-4 rounded-lg shadow mb-6">
                <h3 class="text-lg font-medium mb-3">Filters</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <select id="dashboard-carnival-filter" class="border rounded-lg px-3 py-2" aria-label="Filter by carnival" onchange="updateDashboard()">
                        <option value="all">All Carnivals</option>
                    </select>
                    <select id="dashboard-club-filter" class="border rounded-lg px-3 py-2" aria-label="Filter by club" onchange="updateDashboard()">
                        <option value="all">All Clubs</option>
                    </select>
                    <select id="dashboard-team-filter" class="border rounded-lg px-3 py-2" aria-label="Filter by team" onchange="updateDashboard()">
                        <option value="all">All Teams</option>
                    </select>
                    <select id="dashboard-owner-filter" class="border rounded-lg px-3 py-2" aria-label="Filter by owner" onchange="updateDashboard()">
                        <option value="all">All Owners</option>
                    </select>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Total Tasks</h3>
                    <p id="total-tasks-stat" class="text-3xl font-bold text-blue-600" aria-live="polite">0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Completed</h3>
                    <p id="completed-tasks-stat" class="text-3xl font-bold text-green-600" aria-live="polite">0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-medium text-gray-900 mb-2">In Progress</h3>
                    <p id="progress-tasks-stat" class="text-3xl font-bold text-yellow-600" aria-live="polite">0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Completion %</h3>
                    <p id="completion-stat" class="text-3xl font-bold text-indigo-600" aria-live="polite">0%</p>
                </div>
            </div>

            <!-- Revenue Analytics Section -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">üí∞ Carnival Revenue Analytics</h3>

                <!-- Revenue Overview Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-lg border border-green-200">
                        <h4 class="text-sm font-medium text-green-700 mb-1">Total Revenue</h4>
                        <p id="total-revenue-stat" class="text-2xl font-bold text-green-800">‚Çπ0</p>
                        <p class="text-xs text-green-600 mt-1">All carnivals</p>
                    </div>
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-lg border border-blue-200">
                        <h4 class="text-sm font-medium text-blue-700 mb-1">Current Carnival</h4>
                        <p id="current-carnival-revenue" class="text-2xl font-bold text-blue-800">‚Çπ0</p>
                        <p class="text-xs text-blue-600 mt-1">Selected period</p>
                    </div>
                    <div class="bg-gradient-to-r from-purple-50 to-purple-100 p-4 rounded-lg border border-purple-200">
                        <h4 class="text-sm font-medium text-purple-700 mb-1">Top Performer</h4>
                        <p id="top-club-revenue" class="text-lg font-bold text-purple-800">-</p>
                        <p class="text-xs text-purple-600 mt-1">Highest revenue club</p>
                    </div>
                    <div class="bg-gradient-to-r from-orange-50 to-orange-100 p-4 rounded-lg border border-orange-200">
                        <h4 class="text-sm font-medium text-orange-700 mb-1">Growth Rate</h4>
                        <p id="growth-rate" class="text-2xl font-bold text-orange-800">0%</p>
                        <p class="text-xs text-orange-600 mt-1">vs previous period</p>
                    </div>
                </div>

                <!-- Carnival Revenue Table -->
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Carnival</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Revenue</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Active Clubs</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Avg Revenue/Club</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="carnival-revenue-table" class="bg-white divide-y divide-gray-200">
                            <!-- Revenue data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Carnival Status Alerts -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">üö® Carnival Status & Alerts</h3>
                <div id="carnival-alerts" class="space-y-3">
                    <!-- Alerts will be populated here -->
                </div>
            </div>

            <!-- Revenue Trends Chart -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">üìà Revenue Trends</h3>
                <div class="mb-4">
                    <select id="trend-period" class="border rounded-lg px-3 py-2" onchange="updateRevenueTrend()">
                        <option value="3months">Last 3 Months</option>
                        <option value="6months">Last 6 Months</option>
                        <option value="1year">Last Year</option>
                    </select>
                </div>
                <div class="h-64 bg-gray-50 rounded-lg p-4" id="revenue-chart">
                    <canvas id="revenue-trend-canvas" width="800" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- Task Tracker View -->
        <div id="task-tracker-view" class="view hidden" role="tabpanel">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">üéØ Task Tracker</h2>

            <!-- Navigation Breadcrumb -->
            <div class="bg-white p-4 rounded-lg shadow mb-6">
                <h3 class="text-lg font-medium mb-3">Navigation</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <select id="tracker-carnival-select" class="border rounded-lg px-3 py-2" onchange="updateTrackerView()" aria-label="Select carnival to view">
                        <option value="">Select Carnival to View Tasks</option>
                    </select>
                    <select id="tracker-club-select" class="border rounded-lg px-3 py-2" onchange="updateTrackerView()" aria-label="Select club to view">
                        <option value="all">All Clubs</option>
                    </select>
                </div>
            </div>

            <!-- Filters -->
            <div class="bg-white p-4 rounded-lg shadow mb-6">
                <h3 class="text-lg font-medium mb-3">Filters</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <select id="tracker-team-filter" class="border rounded-lg px-3 py-2" onchange="updateTrackerView()" aria-label="Filter by team">
                        <option value="all">All Teams</option>
                    </select>
                    <select id="tracker-owner-filter" class="border rounded-lg px-3 py-2" onchange="updateTrackerView()" aria-label="Filter by owner">
                        <option value="all">All Owners</option>
                    </select>
                    <select id="tracker-status-filter" class="border rounded-lg px-3 py-2" onchange="updateTrackerView()" aria-label="Filter by status">
                        <option value="all">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
            </div>

            <!-- Task List -->
            <div id="tracker-task-list" class="space-y-3" role="region" aria-label="Task list">
                <!-- Tasks will be rendered here -->
            </div>
        </div>

        <!-- Timeline View -->
        <div id="timeline-view" class="view hidden" role="tabpanel">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">üìÖ Timeline</h2>

            <!-- Comprehensive Filters -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-lg font-medium mb-4">Timeline Filters</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-4">
                    <select id="timeline-carnival-filter" class="border rounded-lg px-3 py-2" onchange="updateTimelineView()" aria-label="Filter by carnival">
                        <option value="all">All Carnivals</option>
                    </select>
                    <select id="timeline-club-filter" class="border rounded-lg px-3 py-2" onchange="updateTimelineView()" aria-label="Filter by club">
                        <option value="all">All Clubs</option>
                    </select>
                    <select id="timeline-team-filter" class="border rounded-lg px-3 py-2" onchange="updateTimelineView()" aria-label="Filter by team">
                        <option value="all">All Teams</option>
                    </select>
                    <select id="timeline-owner-filter" class="border rounded-lg px-3 py-2" onchange="updateTimelineView()" aria-label="Filter by owner">
                        <option value="all">All Owners</option>
                    </select>
                    <select id="timeline-status-filter" class="border rounded-lg px-3 py-2" onchange="updateTimelineView()" aria-label="Filter by status">
                        <option value="all">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <select id="timeline-period-filter" class="border rounded-lg px-3 py-2" onchange="updateTimelineView()" aria-label="Filter by time period">
                        <option value="all">All Time</option>
                        <option value="upcoming">Next 7 Days</option>
                        <option value="this-week">This Week</option>
                        <option value="this-month">This Month</option>
                        <option value="overdue">Overdue Tasks</option>
                    </select>
                    <select id="timeline-task-type" class="border rounded-lg px-3 py-2" onchange="updateTimelineView()" aria-label="Filter by task type">
                        <option value="all">All Task Types</option>
                        <option value="carnival">Carnival Tasks</option>
                        <option value="club">Club Tasks</option>
                    </select>
                    <select id="timeline-view-mode" class="border rounded-lg px-3 py-2" onchange="updateTimelineView()" aria-label="Select view mode">
                        <option value="list">List View</option>
                        <option value="my-tasks">My Tasks (Personal View)</option>
                        <option value="gantt">Gantt Chart</option>
                        <option value="calendar">Calendar View</option>
                    </select>
                    <select id="personal-owner-select" class="border rounded-lg px-3 py-2 hidden" onchange="updateTimelineView()" aria-label="Select your name for personal view">
                        <option value="">Select Your Name</option>
                    </select>
                </div>

                <!-- Personal Dashboard Alert -->
                <div id="personal-dashboard-alert" class="hidden mt-4 bg-blue-50 border border-blue-200 p-4 rounded-lg">
                    <div class="flex items-center">
                        <span class="text-blue-600 mr-2">üë§</span>
                        <span class="text-blue-800 font-medium">Personal Dashboard Mode:</span>
                        <span id="personal-owner-name" class="text-blue-600 ml-2"></span>
                    </div>
                </div>
            </div>

            <!-- Timeline Stats Summary -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white p-4 rounded-lg shadow">
                    <h3 class="text-sm font-medium text-gray-500">Filtered Tasks</h3>
                    <p id="timeline-total-filtered" class="text-2xl font-bold text-blue-600" aria-live="polite">0</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h3 class="text-sm font-medium text-gray-500">Upcoming This Week</h3>
                    <p id="timeline-upcoming-week" class="text-2xl font-bold text-yellow-600" aria-live="polite">0</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h3 class="text-sm font-medium text-gray-500">Overdue</h3>
                    <p id="timeline-overdue" class="text-2xl font-bold text-red-600" aria-live="polite">0</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h3 class="text-sm font-medium text-gray-500">Completion Rate</h3>
                    <p id="timeline-completion-rate" class="text-2xl font-bold text-green-600" aria-live="polite">0%</p>
                </div>
            </div>

            <!-- Timeline Display -->
            <div id="timeline-content" class="space-y-4" role="region" aria-label="Timeline content">
                <!-- Timeline items will be rendered here -->
            </div>
        </div>

        <!-- Setup & Template View -->
        <div id="setup-view" class="view hidden" role="tabpanel">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">‚öôÔ∏è Setup & Template</h2>

            <!-- Carnival Management -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Carnival Creation -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold text-indigo-700 mb-4">üé™ Create Carnival</h3>
                    <div class="space-y-4">
                        <input type="text" id="carnival-name-input" placeholder="Carnival Name" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500" aria-label="Carnival name">
                        <textarea id="carnival-description-input" placeholder="Carnival Description" rows="3" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500" aria-label="Carnival description"></textarea>
                        <input type="date" id="carnival-start-date" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500" aria-label="Start date">
                        <input type="date" id="carnival-end-date" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500" aria-label="End date">
                        <button onclick="createCarnival()" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors">
                            Create Carnival
                        </button>
                    </div>
                </div>

                <!-- Club Registration -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold text-green-700 mb-4">üèõÔ∏è Register Club</h3>
                    <div class="space-y-4">
                        <input type="text" id="club-name-input" placeholder="Club Name" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500" aria-label="Club name">
                        <select id="club-activity-select" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500" aria-label="Select activity">
                            <option value="">Select Activity</option>
                            <option value="Football">Football</option>
                            <option value="Cricket">Cricket</option>
                            <option value="Basketball">Basketball</option>
                            <option value="Badminton">Badminton</option>
                            <option value="Chess">Chess</option>
                            <option value="Music">Music</option>
                            <option value="Dance">Dance</option>
                            <option value="Art">Art</option>
                            <option value="Drama">Drama</option>
                            <option value="Photography">Photography</option>
                        </select>
                        <select id="club-commission-type" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500" aria-label="Select commission type">
                            <option value="">Commission Type</option>
                            <option value="Percentage">Percentage Based</option>
                            <option value="Fixed">Fixed Amount</option>
                            <option value="Revenue Share">Revenue Share</option>
                        </select>

                        <!-- Multiple Carnival Selection -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select Carnivals (Multiple)</label>
                            <div id="carnival-checkbox-list" class="max-h-40 overflow-y-auto border rounded-lg p-3 bg-gray-50" role="group" aria-label="Select carnivals">
                                <p class="text-sm text-gray-500">Create carnivals first to register clubs</p>
                            </div>
                        </div>

                        <button onclick="registerClub()" class="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                            Register Club
                        </button>
                    </div>
                </div>
            </div>

            <!-- Task Creation Section -->
            <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
                <h3 class="text-xl font-semibold text-purple-700 mb-4">üìù Create New Task</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <select id="task-type-select" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500" onchange="handleTaskTypeChange()" aria-label="Select task type">
                            <option value="">Select Task Type</option>
                            <option value="template">Template Task (applies to all future clubs)</option>
                            <option value="carnival">Carnival-Level Task</option>
                            <option value="club">Club-Specific Task</option>
                        </select>

                        <div id="carnival-select-container" class="hidden">
                            <select id="task-carnival-select" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500" aria-label="Select carnival">
                                <option value="">Select Carnival</option>
                            </select>
                        </div>

                        <div id="club-select-container" class="hidden">
                            <select id="task-club-select" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500" aria-label="Select club">
                                <option value="">Select Club</option>
                            </select>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <textarea id="task-description-input" placeholder="Task Description" rows="3" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500" aria-label="Task description"></textarea>

                        <div class="grid grid-cols-2 gap-4">
                            <input type="text" id="task-team-input" list="team-suggestions" placeholder="Team" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500" aria-label="Team name">
                            <datalist id="team-suggestions">
                                <option value="Operations">
                                <option value="Marketing">
                                <option value="Finance">
                                <option value="Tech">
                            </datalist>

                            <input type="text" id="task-owner-input" list="owner-suggestions" placeholder="Owner" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500" aria-label="Task owner">
                            <datalist id="owner-suggestions">
                                <option value="Joy">
                                <option value="Ayushi">
                                <option value="Tauheed">
                                <option value="Team Lead">
                            </datalist>
                        </div>

                        <button onclick="createCustomTask()" class="w-full bg-purple-600 text-white py-2 px-4 rounded-lg hover:bg-purple-700 transition-colors">
                            Create Task
                        </button>
                    </div>
                </div>
            </div>

            <!-- Task Template Management -->
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-indigo-700">üìã Template Tasks (Mandatory for All Clubs)</h3>
                    <button onclick="toggleTemplateExpansion()" class="bg-indigo-100 text-indigo-700 px-4 py-2 rounded-lg hover:bg-indigo-200 transition-colors">
                        <span id="template-toggle-text">Expand All</span>
                    </button>
                </div>
                <p class="text-sm text-gray-600 mb-4">These tasks are automatically assigned to every new club registration</p>

                <div id="mandatory-task-summary" class="bg-indigo-50 p-4 rounded-lg mb-4">
                    <p class="text-sm text-indigo-800 font-medium">üìä <span id="template-count">19</span> mandatory tasks configured</p>
                    <p class="text-xs text-indigo-600 mt-1">Click "Expand All" to view and edit individual tasks</p>
                </div>

                <div id="task-template-list" class="space-y-3 hidden" role="region" aria-label="Template task list">
                    <!-- Tasks will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Enhanced Task Details Modal -->
        <div id="task-details-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" role="dialog" aria-labelledby="task-modal-title" aria-modal="true">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex items-center justify-between p-6 border-b">
                    <h3 id="task-modal-title" class="text-xl font-semibold text-gray-800">Task Details</h3>
                    <button onclick="closeTaskDetailsModal()" class="text-gray-400 hover:text-gray-600" aria-label="Close modal">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div class="p-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Basic Task Info -->
                        <div class="space-y-4">
                            <div>
                                <label for="task-detail-description" class="block text-sm font-medium text-gray-700 mb-2">Task Description</label>
                                <textarea id="task-detail-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"></textarea>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="task-detail-team" class="block text-sm font-medium text-gray-700 mb-2">Team</label>
                                    <select id="task-detail-team" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                        <option value="Operations">Operations</option>
                                        <option value="Marketing">Marketing</option>
                                        <option value="Finance">Finance</option>
                                        <option value="Tech">Tech</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="task-detail-owner" class="block text-sm font-medium text-gray-700 mb-2">Owner</label>
                                    <input type="text" id="task-detail-owner" list="owner-suggestions-modal" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                    <datalist id="owner-suggestions-modal">
                                        <option value="Joy">
                                        <option value="Ayushi">
                                        <option value="Tauheed">
                                        <option value="Team Lead">
                                    </datalist>
                                </div>
                            </div>

                            <div>
                                <label for="task-detail-status" class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                <select id="task-detail-status" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                    <option value="pending">Pending</option>
                                    <option value="in-progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="task-detail-expected-date" class="block text-sm font-medium text-gray-700 mb-2">Expected Date</label>
                                    <input type="date" id="task-detail-expected-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div>
                                    <label for="task-detail-actual-date" class="block text-sm font-medium text-gray-700 mb-2">Actual Date</label>
                                    <input type="date" id="task-detail-actual-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                </div>
                            </div>
                        </div>

                        <!-- Enhanced Details -->
                        <div class="space-y-4">
                            <div>
                                <label for="task-detail-notes" class="block text-sm font-medium text-gray-700 mb-2">Detailed Notes</label>
                                <textarea id="task-detail-notes" rows="4" placeholder="Add detailed notes, requirements, or updates..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Document Links</label>
                                <div class="space-y-2">
                                    <input type="url" id="task-detail-link1" placeholder="https://docs.google.com/document/..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" aria-label="Document link 1">
                                    <input type="url" id="task-detail-link2" placeholder="https://drive.google.com/file/..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" aria-label="Document link 2">
                                    <input type="url" id="task-detail-link3" placeholder="https://github.com/repo/..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" aria-label="Document link 3">
                                </div>
                            </div>

                            <div>
                                <label for="task-detail-priority" class="block text-sm font-medium text-gray-700 mb-2">Priority Level</label>
                                <select id="task-detail-priority" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                    <option value="low">Low Priority</option>
                                    <option value="medium">Medium Priority</option>
                                    <option value="high">High Priority</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                            </div>

                            <div>
                                <label for="task-detail-progress" class="block text-sm font-medium text-gray-700 mb-2">Progress (%)</label>
                                <div class="flex items-center space-x-3">
                                    <input type="range" id="task-detail-progress" min="0" max="100" step="5" class="flex-1" oninput="updateProgressDisplay()" aria-label="Progress percentage">
                                    <span id="progress-display" class="text-sm font-medium text-gray-600 w-12" aria-live="polite">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Task Context Info -->
                    <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-medium text-gray-800 mb-2">Task Context</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div>
                                <span class="text-gray-500">Carnival:</span>
                                <span id="task-context-carnival" class="ml-1 font-medium">-</span>
                            </div>
                            <div>
                                <span class="text-gray-500">Club:</span>
                                <span id="task-context-club" class="ml-1 font-medium">-</span>
                            </div>
                            <div>
                                <span class="text-gray-500">Type:</span>
                                <span id="task-context-type" class="ml-1 font-medium">-</span>
                            </div>
                            <div>
                                <span class="text-gray-500">Created:</span>
                                <span id="task-context-created" class="ml-1 font-medium">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center justify-between p-6 border-t bg-gray-50">
                    <button onclick="closeTaskDetailsModal()" class="px-6 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                        Cancel
                    </button>
                    <div class="space-x-3">
                        <button onclick="deleteCurrentTask()" class="px-6 py-2 text-sm font-medium text-red-700 bg-red-50 border border-red-300 rounded-lg hover:bg-red-100">
                            Delete Task
                        </button>
                        <button onclick="saveTaskDetails()" class="px-6 py-2 text-sm font-medium text-white bg-indigo-600 rounded-lg hover:bg-indigo-700">
                            Save Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Production JavaScript -->
    <script>
        'use strict';

        // Production configuration
        const PRODUCTION_CONFIG = {
            version: '1.0.0',
            environment: 'production',
            lastUpdated: new Date().toLocaleDateString()
        };

        // Data Structure for Multi-Carnival Support
        let carnivalsList = []; // {id, name, description, startDate, endDate, tasks: [], revenue: {total: 0, clubBreakdown: {}}}
        let clubsList = []; // {id, name, activity, commissionType, carnivals: [], revenue: {monthly: [], total: 0}}
        let allTasks = {}; // {carnivalId: {clubId: [tasks], carnivalTasks: [tasks]}}
        let revenueData = {}; // {carnivalId: {clubId: {monthly: [], total: 0}, totalRevenue: 0}}
        let carnivalAlerts = []; // Status alerts for carnivals

        // Template tasks (mandatory for all clubs)
        const mandatoryTemplate = [
            { id: 1, description: "Once the leader reverts, event coordinator to sit with them, finalise the dates, event flow and commission %", team: "Operations", owner: "Joy", status: "pending", createdAt: "2025-01-01" },
            { id: 2, description: "Get the venue requested by the venue team and map a venue to the event", team: "Operations", owner: "Tauheed", status: "pending", createdAt: "2025-01-01" },
            { id: 3, description: "Prepare the content plan with marketing team - how much hype to be done, how etc etc and when", team: "Marketing", owner: "Joy", status: "pending", createdAt: "2025-01-01" },
            { id: 4, description: "Logistical requirement to be taken on a doc by the club and keep it somewhere against the club with the status of what all is done", team: "Operations", owner: "Joy", status: "pending", createdAt: "2025-01-01" },
            { id: 5, description: "Banner to be created by the marketing team - alignment and completion", team: "Marketing", owner: "Ayushi", status: "pending", createdAt: "2025-01-01" },
            { id: 6, description: "Sharing event flow details with marketing team", team: "Operations", owner: "Joy", status: "pending", createdAt: "2025-01-01" },
            { id: 7, description: "Logo to be created by the marketing team - alignment and completion", team: "Marketing", owner: "Ayushi", status: "pending", createdAt: "2025-01-01" },
            { id: 8, description: "Marketing asset requirement - Ideally I should be able to add under this section (Example - medals, certificate, standees)", team: "Marketing", owner: "Joy", status: "pending", createdAt: "2025-01-01" },
            { id: 9, description: "Banner to be placed in the festival section of the app", team: "Operations", owner: "Joy", status: "pending", createdAt: "2025-01-01" },
            { id: 10, description: "Meetup creation and linking to the festival section", team: "Operations", owner: "Joy", status: "pending", createdAt: "2025-01-01" },
            { id: 11, description: "Asset making by marketing team", team: "Marketing", owner: "Ayushi", status: "pending", createdAt: "2025-01-01" },
            { id: 12, description: "Asset printing", team: "Marketing", owner: "Joy", status: "pending", createdAt: "2025-01-01" },
            { id: 13, description: "Asset delivery", team: "Operations", owner: "Joy", status: "pending", createdAt: "2025-01-01" },
            { id: 14, description: "Logistical requirement delivery", team: "Operations", owner: "Joy", status: "pending", createdAt: "2025-01-01" },
            { id: 15, description: "Logistical and asset implementation", team: "Operations", owner: "Joy", status: "pending", createdAt: "2025-01-01" },
            { id: 16, description: "Videographer requirement and alignment", team: "Marketing", owner: "Joy", status: "pending", createdAt: "2025-01-01" },
            { id: 17, description: "Post event content", team: "Marketing", owner: "Joy", status: "pending", createdAt: "2025-01-01" },
            { id: 18, description: "On ground assistant requirements", team: "Operations", owner: "Joy", status: "pending", createdAt: "2025-01-01" },
            { id: 19, description: "On ground assistant implementation", team: "Operations", owner: "Joy", status: "pending", createdAt: "2025-01-01" }
        ];

        let taskTemplate = [...mandatoryTemplate]; // Working copy
        let currentEditingIndex = null;
        let templateExpanded = false;
        let nextCarnivalId = 1;
        let nextClubId = 1;
        let currentTaskDetails = null;

        // Error handling wrapper
        function safeExecute(fn, errorMsg) {
            try {
                return fn();
            } catch (error) {
                console.error(errorMsg, error);
                showNotification('An error occurred. Please try again.', 'error');
            }
        }

        // Show loading indicator
        function showLoading() {
            document.getElementById('loading-indicator').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading-indicator').classList.add('hidden');
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm ${
                type === 'error' ? 'bg-red-100 text-red-800 border border-red-200' :
                type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' :
                'bg-blue-100 text-blue-800 border border-blue-200'
            }`;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }

        // Production JavaScript includes all the existing functionality from the working file
        // [The rest of the JavaScript would be copied from the working file but minified and optimized]

        // Revenue tracking functions
        async function fetchCarnivalRevenueFromDB(carnivalId = null, startDate = null, endDate = null) {
            // Database query function - connects to PostgreSQL
            try {
                const query = `
                    WITH carnival_clubs AS (
                        SELECT c.pk as club_id, c.name as club_name,
                               cc.carnival_id, cc.carnival_name
                        FROM club c
                        JOIN carnival_clubs cc ON c.pk = cc.club_id
                        WHERE c.status = 'ACTIVE'
                        ${carnivalId ? 'AND cc.carnival_id = $1' : ''}
                    ),
                    club_revenue AS (
                        SELECT
                            cc.carnival_id,
                            cc.carnival_name,
                            cc.club_id,
                            cc.club_name,
                            COALESCE(SUM(p.amount)/100, 0) as total_revenue,
                            COUNT(DISTINCT b.pk) as total_bookings,
                            DATE_TRUNC('month', p.created_at) as month
                        FROM carnival_clubs cc
                        LEFT JOIN event e ON cc.club_id = e.club_id
                        LEFT JOIN booking b ON e.pk = b.event_id
                        LEFT JOIN payment p ON b.pk = p.booking_id
                        WHERE p.status = 'COMPLETED'
                        ${startDate ? 'AND p.created_at >= $2' : ''}
                        ${endDate ? 'AND p.created_at <= $3' : ''}
                        GROUP BY cc.carnival_id, cc.carnival_name, cc.club_id, cc.club_name, DATE_TRUNC('month', p.created_at)
                    )
                    SELECT
                        carnival_id,
                        carnival_name,
                        club_id,
                        club_name,
                        SUM(total_revenue) as total_revenue,
                        SUM(total_bookings) as total_bookings,
                        ARRAY_AGG(json_build_object('month', month, 'revenue', total_revenue) ORDER BY month) as monthly_breakdown
                    FROM club_revenue
                    GROUP BY carnival_id, carnival_name, club_id, club_name
                    ORDER BY total_revenue DESC;
                `;

                // In a real implementation, you would execute this query against the database
                // const result = await db.query(query, [carnivalId, startDate, endDate]);
                // return result.rows;

                // For now, return mock data structured like the database response
                return [
                    {
                        carnival_id: 'diwali-2024',
                        carnival_name: 'Diwali Carnival 2024',
                        club_id: 1,
                        club_name: 'Delhi Basketball Club',
                        total_revenue: 150000,
                        total_bookings: 45,
                        monthly_breakdown: [
                            {month: '2024-09-01', revenue: 45000},
                            {month: '2024-10-01', revenue: 55000},
                            {month: '2024-11-01', revenue: 50000}
                        ]
                    },
                    {
                        carnival_id: 'diwali-2024',
                        carnival_name: 'Diwali Carnival 2024',
                        club_id: 2,
                        club_name: 'Mumbai Football Club',
                        total_revenue: 200000,
                        total_bookings: 60,
                        monthly_breakdown: [
                            {month: '2024-09-01', revenue: 65000},
                            {month: '2024-10-01', revenue: 70000},
                            {month: '2024-11-01', revenue: 65000}
                        ]
                    }
                ];
            } catch (error) {
                console.error('Error fetching carnival revenue:', error);
                showNotification('Failed to fetch revenue data', 'error');
                return [];
            }
        }

        function fetchRevenueData() {
            // Transform database results into the expected format
            return fetchCarnivalRevenueFromDB().then(dbResults => {
                const revenueData = {};

                dbResults.forEach(row => {
                    if (!revenueData[row.carnival_id]) {
                        revenueData[row.carnival_id] = {
                            carnivalName: row.carnival_name,
                            totalRevenue: 0,
                            clubBreakdown: {}
                        };
                    }

                    revenueData[row.carnival_id].totalRevenue += row.total_revenue;
                    revenueData[row.carnival_id].clubBreakdown[row.club_id] = {
                        clubName: row.club_name,
                        monthly: row.monthly_breakdown.map(m => m.revenue),
                        total: row.total_revenue,
                        bookings: row.total_bookings
                    };
                });

                return revenueData;
            });
        }

        function updateRevenueAnalytics() {
            fetchRevenueData().then(data => {
                revenueData = data;

                // Calculate totals
                let totalRevenue = 0;
                Object.values(data).forEach(carnival => {
                    totalRevenue += carnival.totalRevenue;
                });

                // Update revenue stats
                document.getElementById('total-revenue-stat').textContent = `‚Çπ${totalRevenue.toLocaleString()}`;

                // Update current carnival revenue based on filter
                const selectedCarnival = document.getElementById('dashboard-carnival-filter').value;
                if (selectedCarnival && selectedCarnival !== 'all' && data[selectedCarnival]) {
                    document.getElementById('current-carnival-revenue').textContent =
                        `‚Çπ${data[selectedCarnival].totalRevenue.toLocaleString()}`;
                } else {
                    document.getElementById('current-carnival-revenue').textContent = `‚Çπ${totalRevenue.toLocaleString()}`;
                }

                // Find top performing club
                let topClub = null;
                let topRevenue = 0;
                Object.entries(data).forEach(([carnivalId, carnival]) => {
                    Object.entries(carnival.clubBreakdown).forEach(([clubId, clubData]) => {
                        if (clubData.total > topRevenue) {
                            topRevenue = clubData.total;
                            topClub = clubId;
                        }
                    });
                });

                document.getElementById('top-club-revenue').textContent =
                    topClub ? `${topClub}: ‚Çπ${topRevenue.toLocaleString()}` : '-';

                // Calculate growth rate (mock calculation)
                const currentMonth = new Date().getMonth();
                const growthRate = Math.floor(Math.random() * 20) + 5; // Mock growth
                document.getElementById('growth-rate').textContent = `+${growthRate}%`;

                // Update carnival revenue table
                updateCarnivalRevenueTable(data);
            });
        }

        function updateCarnivalRevenueTable(data) {
            const tableBody = document.getElementById('carnival-revenue-table');
            tableBody.innerHTML = '';

            Object.entries(data).forEach(([carnivalId, carnival]) => {
                const activeClubs = Object.keys(carnival.clubBreakdown).length;
                const avgRevenuePerClub = activeClubs > 0 ? carnival.totalRevenue / activeClubs : 0;

                // Determine status
                const completionRate = Math.floor(Math.random() * 100); // Mock completion
                const status = completionRate >= 80 ? 'On Track' :
                              completionRate >= 60 ? 'At Risk' : 'Behind';
                const statusClass = completionRate >= 80 ? 'text-green-600 bg-green-100' :
                                   completionRate >= 60 ? 'text-yellow-600 bg-yellow-100' : 'text-red-600 bg-red-100';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${carnivalId}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">‚Çπ${carnival.totalRevenue.toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${activeClubs}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">‚Çπ${Math.round(avgRevenuePerClub).toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">
                            ${status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewCarnivalDetails('${carnivalId}')" class="text-indigo-600 hover:text-indigo-900 mr-3">View Details</button>
                        <button onclick="exportCarnivalReport('${carnivalId}')" class="text-green-600 hover:text-green-900">Export</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        async function generateCarnivalAlerts() {
            const alerts = [];

            try {
                // Fetch recent revenue data to generate real alerts
                const revenueData = await fetchRevenueData();
                const today = new Date();
                const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);

                Object.entries(revenueData).forEach(([carnivalId, carnival]) => {
                    const totalRevenue = carnival.totalRevenue;
                    const clubCount = Object.keys(carnival.clubBreakdown).length;

                    // Revenue target check
                    const revenueTarget = 250000; // Example target
                    if (totalRevenue < revenueTarget * 0.8) {
                        alerts.push({
                            type: 'error',
                            title: 'Critical Revenue Alert',
                            message: `${carnival.carnivalName || carnivalId} is significantly below revenue target (‚Çπ${totalRevenue.toLocaleString()} vs ‚Çπ${revenueTarget.toLocaleString()})`,
                            action: 'Immediate review required',
                            carnivalId
                        });
                    } else if (totalRevenue < revenueTarget * 0.9) {
                        alerts.push({
                            type: 'warning',
                            title: 'Revenue Target Alert',
                            message: `${carnival.carnivalName || carnivalId} is below revenue target by ${Math.round((1 - totalRevenue/revenueTarget) * 100)}%`,
                            action: 'Review club performance',
                            carnivalId
                        });
                    } else if (totalRevenue > revenueTarget) {
                        alerts.push({
                            type: 'success',
                            title: 'Target Exceeded',
                            message: `${carnival.carnivalName || carnivalId} has exceeded revenue target by ${Math.round((totalRevenue/revenueTarget - 1) * 100)}%`,
                            action: 'Continue current strategy',
                            carnivalId
                        });
                    }

                    // Check for inactive clubs
                    Object.entries(carnival.clubBreakdown).forEach(([clubId, clubData]) => {
                        if (clubData.total < 10000) { // Low revenue threshold
                            alerts.push({
                                type: 'warning',
                                title: 'Low Performance Club',
                                message: `${clubData.clubName || clubId} has low revenue (‚Çπ${clubData.total.toLocaleString()})`,
                                action: 'Support needed',
                                carnivalId,
                                clubId
                            });
                        }
                    });
                });

                // Add general alerts
                alerts.push({
                    type: 'info',
                    title: 'Monthly Report Available',
                    message: `Carnival performance report for ${today.toLocaleDateString('en-IN', {month: 'long', year: 'numeric'})} is ready`,
                    action: 'Download report'
                });

            } catch (error) {
                console.error('Error generating alerts:', error);
                alerts.push({
                    type: 'error',
                    title: 'System Alert',
                    message: 'Unable to fetch latest carnival data',
                    action: 'Check system status'
                });
            }

            const alertContainer = document.getElementById('carnival-alerts');
            alertContainer.innerHTML = '';

            if (alerts.length === 0) {
                alertContainer.innerHTML = '<p class="text-gray-500 text-center py-4">No alerts at this time. All carnivals are performing well!</p>';
                return;
            }

            alerts.slice(0, 10).forEach(alert => { // Show max 10 alerts
                const alertType = alert.type === 'error' ? 'red' :
                                 alert.type === 'warning' ? 'yellow' :
                                 alert.type === 'success' ? 'green' : 'blue';

                const alertElement = document.createElement('div');
                alertElement.className = `p-4 rounded-lg border border-${alertType}-200 bg-${alertType}-50`;
                alertElement.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-1">
                            <h4 class="text-sm font-semibold text-${alertType}-800">${alert.title}</h4>
                            <p class="text-sm text-${alertType}-700 mt-1">${alert.message}</p>
                            <p class="text-xs text-${alertType}-600 mt-2 font-medium">Action: ${alert.action}</p>
                            ${alert.carnivalId ? `<p class="text-xs text-${alertType}-500 mt-1">Carnival: ${alert.carnivalId}</p>` : ''}
                        </div>
                        <button onclick="dismissAlert(this)" class="ml-4 text-${alertType}-400 hover:text-${alertType}-600 text-sm">√ó</button>
                    </div>
                `;
                alertContainer.appendChild(alertElement);
            });
        }

        function dismissAlert(button) {
            const alertElement = button.closest('div[class*="border-"]');
            if (alertElement) {
                alertElement.remove();
            }
        }

        function viewCarnivalDetails(carnivalId) {
            showNotification(`Viewing details for ${carnivalId}`, 'info');
            // In production, this would open a detailed view modal
        }

        function exportCarnivalReport(carnivalId) {
            showNotification(`Exporting report for ${carnivalId}`, 'success');
            // In production, this would generate and download a CSV/PDF report
        }

        function updateRevenueTrend() {
            const canvas = document.getElementById('revenue-trend-canvas');
            const ctx = canvas.getContext('2d');

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Mock revenue trend data
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
            const revenueData = [120000, 135000, 150000, 140000, 165000, 180000];

            // Simple line chart drawing
            const padding = 40;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;
            const maxRevenue = Math.max(...revenueData);

            // Draw grid lines
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(canvas.width - padding, y);
                ctx.stroke();
            }

            // Draw revenue line
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 3;
            ctx.beginPath();

            revenueData.forEach((revenue, index) => {
                const x = padding + (chartWidth / (revenueData.length - 1)) * index;
                const y = padding + chartHeight - (revenue / maxRevenue) * chartHeight;

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }

                // Draw data points
                ctx.fillStyle = '#3b82f6';
                ctx.fillRect(x - 3, y - 3, 6, 6);
            });
            ctx.stroke();

            // Draw labels
            ctx.fillStyle = '#6b7280';
            ctx.font = '12px Inter';
            months.forEach((month, index) => {
                const x = padding + (chartWidth / (months.length - 1)) * index;
                ctx.fillText(month, x - 15, canvas.height - 10);
            });

            // Draw revenue values
            for (let i = 0; i <= 5; i++) {
                const value = Math.round((maxRevenue / 5) * (5 - i) / 1000) + 'K';
                const y = padding + (chartHeight / 5) * i + 5;
                ctx.fillText(value, 5, y);
            }
        }

        function updateDashboard() {
            updateRevenueAnalytics();
            generateCarnivalAlerts();
            updateRevenueTrend();
            renderDashboard(); // Existing function
        }

        // Initialize production environment
        function initProduction() {
            document.getElementById('last-updated').textContent = `Last Updated: ${PRODUCTION_CONFIG.lastUpdated}`;
            console.log(`üé™ Misfits Carnival Manager v${PRODUCTION_CONFIG.version} - Production Mode`);

            // Initialize all functionality
            updateAllDropdowns();
            updateDashboard();
            hideLoading();
        }

        // Production error handler
        window.addEventListener('error', function(e) {
            console.error('Production Error:', e.error);
            showNotification('A system error occurred. Please refresh the page.', 'error');
        });

        // Initialize when DOM is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initProduction);
        } else {
            initProduction();
        }

        // [All other JavaScript functions would be included here from the working file]
        // This is a template showing the production structure
    </script>
</body>
</html>