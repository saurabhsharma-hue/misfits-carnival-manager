<!DOCTYPE html>
<html>
<head>
    <title>Live Website Timeline Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { background: #f5f5f5; padding: 15px; border: 1px solid #ddd; margin: 10px 0; border-radius: 5px; }
        .error { background: #fef2f2; border: 1px solid #fecaca; color: #dc2626; }
        .success { background: #f0fdf4; border: 1px solid #bbf7d0; color: #16a34a; }
        .info { background: #eff6ff; border: 1px solid #93c5fd; color: #1d4ed8; }
        pre { background: white; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Live Website Timeline Debug Test</h1>

    <div class="debug-section info">
        <h3>üéØ Purpose</h3>
        <p>This test will check why Timeline actions aren't showing on the live website (carnival.misfits.net.in)</p>
        <p>We'll simulate the same data loading and filtering logic to identify the issue.</p>
    </div>

    <button onclick="testLiveWebsiteLogic()">üß™ Test Live Website Logic</button>
    <button onclick="debugTimelineFiltering()">üîç Debug Timeline Filtering</button>

    <div id="results"></div>

    <script>
        // Simulate the same data structure as live website
        // Based on user saying "Sports Fever carnival and clubs under it"
        let carnivalsList = [
            {id: 1, name: "Sports Fever", description: "Sports Fever carnival", startDate: "2024-11-15", endDate: "2024-11-30"}
        ];

        let clubsList = [
            {id: 1, name: "Basketball Club", activity: "Sports", carnivals: [1]},
            {id: 2, name: "Football Club", activity: "Sports", carnivals: [1]},
            {id: 3, name: "Volleyball Club", activity: "Sports", carnivals: [1]}
        ];

        // Sample tasks that might exist on live site
        let allTasks = {
            1: {
                carnivalTasks: [
                    {id: 'c1', description: 'Setup sports venue', team: 'Operations', owner: 'Admin', status: 'Pending', expectedDate: '2024-11-20', priority: 'high'},
                    {id: 'c2', description: 'Register participants', team: 'Registration', owner: 'Staff', status: 'In Progress', expectedDate: '2024-11-18', priority: 'medium'}
                ],
                clubs: {
                    1: [
                        {id: 'cl1', description: 'Arrange basketball equipment', team: 'Sports', owner: 'Coach1', status: 'Pending', expectedDate: '2024-11-19', priority: 'high'},
                        {id: 'cl2', description: 'Schedule basketball matches', team: 'Sports', owner: 'Coach1', status: 'Completed', expectedDate: '2024-11-15', priority: 'medium'}
                    ],
                    2: [
                        {id: 'cl3', description: 'Prepare football field', team: 'Sports', owner: 'Coach2', status: 'In Progress', expectedDate: '2024-11-17', priority: 'high'},
                        {id: 'cl4', description: 'Get referees', team: 'Sports', owner: 'Coordinator', status: 'Pending', expectedDate: '2024-11-25', priority: 'low'}
                    ],
                    3: [
                        {id: 'cl5', description: 'Setup volleyball net', team: 'Sports', owner: 'Coach3', status: 'Pending', expectedDate: '2024-11-21', priority: 'medium'}
                    ]
                }
            }
        };

        function testLiveWebsiteLogic() {
            console.clear();
            console.log('üß™ TESTING LIVE WEBSITE LOGIC');
            console.log('================================');

            const results = document.getElementById('results');
            let html = '<div class="debug-section"><h3>üîß Test Results</h3>';

            // Test 1: Data availability
            html += '<h4>1. Data Availability Check</h4>';
            html += `<pre>Carnivals: ${carnivalsList.length} found
Clubs: ${clubsList.length} found
AllTasks keys: ${Object.keys(allTasks).join(', ')}</pre>`;

            // Test 2: Simulate getFilteredTimelineTasks function
            const timelineTasks = getFilteredTimelineTasks();
            html += '<h4>2. Timeline Task Collection</h4>';
            html += `<pre>Total tasks collected: ${timelineTasks.length}
Expected: Should be > 0 for tasks to show</pre>`;

            if (timelineTasks.length === 0) {
                html += '<div class="error"><strong>‚ùå ISSUE FOUND:</strong> No tasks being returned by getFilteredTimelineTasks()</div>';
            } else {
                html += '<div class="success"><strong>‚úÖ Tasks Found:</strong></div>';
                html += '<ul>';
                timelineTasks.forEach(task => {
                    html += `<li>${task.description} (${task.taskType}, ${task.status})</li>`;
                });
                html += '</ul>';
            }

            // Test 3: Check filter dropdowns
            html += '<h4>3. Filter Dropdown Population</h4>';
            const teams = getUniqueValues(timelineTasks, 'team');
            const owners = getUniqueValues(timelineTasks, 'owner');
            const statuses = getUniqueValues(timelineTasks, 'status');

            html += `<pre>Teams: ${teams.join(', ')}
Owners: ${owners.join(', ')}
Statuses: ${statuses.join(', ')}</pre>`;

            html += '</div>';
            results.innerHTML = html;
        }

        function debugTimelineFiltering() {
            console.log('üîç DEBUGGING TIMELINE FILTERING');

            // Test with specific filter combinations that user mentioned
            const testCases = [
                {name: 'All filters', carnival: 'all', club: 'all', team: 'all', owner: 'all', status: 'all'},
                {name: 'Sports team only', carnival: 'all', club: 'all', team: 'Sports', owner: 'all', status: 'all'},
                {name: 'Pending status only', carnival: 'all', club: 'all', team: 'all', owner: 'all', status: 'Pending'},
                {name: 'Sports + Pending', carnival: 'all', club: 'all', team: 'Sports', owner: 'all', status: 'Pending'}
            ];

            let html = '<div class="debug-section"><h3>üîç Filtering Debug Results</h3>';

            testCases.forEach(testCase => {
                console.log(`\n--- Testing: ${testCase.name} ---`);
                const filtered = getFilteredTimelineTasks(
                    testCase.carnival, testCase.club, testCase.team,
                    testCase.owner, testCase.status, 'all'
                );

                html += `<h4>${testCase.name}</h4>`;
                html += `<pre>Filters: carnival=${testCase.carnival}, team=${testCase.team}, status=${testCase.status}
Result: ${filtered.length} tasks</pre>`;

                if (filtered.length > 0) {
                    html += '<div class="success">Tasks found:</div><ul>';
                    filtered.forEach(task => {
                        html += `<li>${task.description} (team: ${task.team}, status: ${task.status})</li>`;
                    });
                    html += '</ul>';
                } else {
                    html += '<div class="error">No tasks match these filters</div>';
                }
            });

            html += '</div>';
            document.getElementById('results').innerHTML += html;
        }

        // Copy the exact filtering logic from the live website
        function getFilteredTimelineTasks(carnivalFilter = 'all', clubFilter = 'all', teamFilter = 'all',
                                        ownerFilter = 'all', statusFilter = 'all', taskTypeFilter = 'all') {
            console.log('=== getFilteredTimelineTasks START ===');
            console.log(`Filters: carnival=${carnivalFilter}, club=${clubFilter}, team=${teamFilter}, owner=${ownerFilter}, status=${statusFilter}, taskType=${taskTypeFilter}`);

            const allTasksList = [];

            const filterTasks = (tasks) => {
                return tasks.filter(task => {
                    if (teamFilter !== 'all' && task.team !== teamFilter) return false;
                    if (ownerFilter !== 'all' && task.owner !== ownerFilter) return false;
                    if (statusFilter !== 'all' && task.status !== statusFilter) return false;
                    return true;
                });
            };

            carnivalsList.forEach(carnival => {
                if (carnivalFilter !== 'all' && carnival.id != carnivalFilter) return;

                const carnivalData = allTasks[carnival.id];
                if (!carnivalData) return;

                // Add carnival tasks
                const carnivalTasks = carnivalData.carnivalTasks || [];
                const filteredCarnivalTasks = filterTasks(carnivalTasks);
                filteredCarnivalTasks.forEach(task => {
                    if (taskTypeFilter === 'all' || taskTypeFilter === 'carnival') {
                        allTasksList.push({
                            ...task,
                            carnivalId: carnival.id,
                            carnivalName: carnival.name,
                            taskType: 'carnival'
                        });
                    }
                });

                // Add club tasks
                const clubs = clubsList.filter(club => club.carnivals.includes(carnival.id));
                clubs.forEach(club => {
                    if (clubFilter !== 'all' && club.id != clubFilter) return;

                    const clubTasks = carnivalData.clubs[club.id] || [];
                    const filteredClubTasks = filterTasks(clubTasks);
                    filteredClubTasks.forEach(task => {
                        if (taskTypeFilter === 'all' || taskTypeFilter === 'club') {
                            allTasksList.push({
                                ...task,
                                carnivalId: carnival.id,
                                carnivalName: carnival.name,
                                clubId: club.id,
                                clubName: club.name,
                                taskType: 'club'
                            });
                        }
                    });
                });
            });

            console.log(`Final result: ${allTasksList.length} tasks`);
            console.log('=== getFilteredTimelineTasks END ===');
            return allTasksList;
        }

        function getUniqueValues(tasks, field) {
            return [...new Set(tasks.map(task => task[field]))].filter(Boolean).sort();
        }

        // Auto-run test on load
        window.onload = function() {
            console.log('üîç Live Website Timeline Debug Tool Loaded');
            console.log('üìä Testing why Timeline actions aren\'t showing on live website');
        };
    </script>
</body>
</html>